
- 必读文章
```
https://testerhome.com/topics/6374
```

- 概要
```
1. 使用gotests命令，来完成表单形式的测试，表单形式的测试最推荐
2. http的单元测试库使用httpexcept
3. sql的单元测试库使用go-sqlmock
4. golang官方mock库使用gomock，除了http和mysql场景的测试之外使用
```

- 单元测试释义
```
不依赖外部，需要隔离外部依赖，对函数或者方法单独做测试。
外部包含：
1. 数据库
2. 一个app服务器（或者任何类型的服务器）
3. 文件/网络 I/O或者文件系统
4. 另外的应用
5. 控制台（System.out,system.err等等）
6. 日志
7. 大多数其他类
```

- 单元测试建议
```
1. 越重要的代码，越要写单元测试；
2. 代码做不到单元测试，多思考如何改进，而不是放弃；
3. 边写业务代码，边写单元测试，而不是完成整个新功能后再写；
4. 多思考如何改进、简化测试代码。
```

- 什么样的代码不能做单元测试？
```
函数，方法依赖其他类，但没有做好对其他类的隔离。比如：直接在方法中new一个依赖类出来，正确的方式，依赖类的接口通过方法的一个参数。
```

- 与系统测试比较
```
应用系统，数据库系统等多系统联合起来做测试。比如观测系统某个外部接口返回是否符合预期。
形如swagger工具：https://petstore.swagger.io/?_ga=2.181287012.2138967229.1548914867-1298560747.1548914867
```

- 表单驱动工具gotests
```
常用命令方法:
gotests -all -w texttoaudio_test.go texttoaudio.go // 为源码texttoaudio.go所有方法都生成测试
gotests -only "GetAudioPath" texttoaudio.go // 仅为GetAudioPath方法生成测试
```

- 官方mock工具gomock
```
文档：https://godoc.org/github.com/golang/mock/gomock
常用命令：
mocgen -destination=textTask_mock.go texttoaudio/server/models TextTaskInf //为texttoaudio/server/models下的接口TextTaskInf 生成mock类
mock出stuct的InfoTextTaskKeyStatus方法
func TextTexttoaudio_GetAudioPath(t *testing.T) {
   mockCtrl := gomock.NewController(t)
   defer mockCtrl.Finish()

   textTaskStuct := mock_models.NewMockTextTaskInf(mockCtrl)
   textTaskStuct.EXPECT().InfoTextTaskKeyStatus(gomock.Any(),gomock.Any).Return(nil)
}
```

- 数据库mock库go-sqlmock
```
文档：https://godoc.org/gopkg.in/DATA-DOG/go-sqlmock.v1
mock出数据库
func TestTextWorker_CreateTextWorker(t *testing.T) {
  db, mock, _ := sqlmock.New()
  mysqlClient, _ := gorm.Open("mysql", db)
 // 对insert操作语句做预期
  mock.ExpectExec("INSERT").WithArgs(taskid).WillReturnErr(nil)
}
```

- 参考文章
```
1. https://studygolang.com/articles/10722
2. https://juejin.im/post/58db5f9ab123db199f54e1e5
```
